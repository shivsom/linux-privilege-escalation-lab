# Analysis of SUID Binary Using system()

## Overview
This directory contains a simple SUID-root C program (`vuln.c`) that invokes the `system()` function without using an absolute path. Historically, this pattern has been vulnerable to PATH hijacking attacks, allowing attackers to execute arbitrary binaries with elevated privileges.

However, on modern Linux distributions such as Ubuntu Server 22.04, this vulnerability does not reliably lead to privilege escalation.

This document explains why.

## The Vulnerable Pattern
The program executes the following logic:

- The binary is owned by root
- The SUID bit is set
- The program calls `system("ls")`

In older or poorly configured systems, this could allow an attacker to place a malicious `ls` binary earlier in the PATH, resulting in arbitrary code execution as root.

## Why This Fails on Ubuntu 22.04

Modern Linux systems implement multiple layers of defense that prevent this attack vector from succeeding:

### 1. Environment Sanitization
When a SUID binary is executed, the operating system and runtime environment sanitize environment variables such as `PATH`. Writable directories (e.g., `/tmp`, current working directory) are typically excluded.

As a result, user-controlled PATH manipulation does not influence command resolution inside the SUID context.

### 2. Hardened system() Behavior
The `system()` function ultimately invokes `/bin/sh -c <command>`. On modern systems, this execution path inherits the sanitized environment, further reducing the risk of user-controlled command resolution.

### 3. Secure Defaults
Ubuntu 22.04 ships with security-conscious defaults enabled through PAM, systemd, and the GNU C Library. These defaults assume SUID binaries are dangerous and restrict their execution context accordingly.

## Security Implication
While the code pattern in `vuln.c` is still considered bad practice, it no longer results in a practical privilege escalation under default configurations.

This demonstrates an important security lesson:
> Not all historically vulnerable patterns remain exploitable on modern systems.

Attack techniques must adapt to evolving defensive measures.

## Recommended Secure Practices
Even though this specific attack fails, the following secure coding practices are recommended:

- Avoid using `system()` in privileged binaries
- Use absolute paths with `execve()` or related functions
- Drop privileges as early as possible
- Avoid SUID binaries when capabilities or service isolation can be used instead

## Conclusion
The failure of this exploit on Ubuntu 22.04 highlights the effectiveness of environment hardening and the importance of validating exploit assumptions against modern systems. This lab intentionally documents this failure to reflect realistic attacker behavior and decision-making.
